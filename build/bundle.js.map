{"version":3,"file":"bundle.js","sources":["../src/index.ts"],"sourcesContent":["import { MessageBot, Player } from '@bhmb/bot'\nimport { UIExtensionExports } from '@bhmb/ui'\n\nimport html from './tab.html'\n\ninterface Settings {\n  onSet: string\n  onClear: string\n  onTrigger: string\n}\n\nMessageBot.registerExtension('bibliofile/afk', (ex, world) => {\n  const getSettings = (): Settings => Object.assign({\n    onSet: 'AFK Message set - Say anything in chat to remove it.',\n    onClear: 'Cleared {{Name}}\\'s AFK Message',\n    onTrigger: ' {{Away}} is AFK. Message: {{message}}',\n  }, ex.storage.get<Partial<Settings>>('settings', {}))\n\n  let triggers = new Map<string, string>()\n  function deleteTrigger(name: string) {\n    triggers.delete(name.toLocaleUpperCase())\n  }\n\n  world.addCommand('afk', (player, message) => {\n    if (player.name === 'SERVER') return\n    triggers.set(player.name, message)\n    ex.bot.send(getSettings().onSet, { name: player.name })\n  })\n  world.addCommand('afkclear', (player, args) => {\n    if (player.isAdmin) {\n      deleteTrigger(args)\n      ex.bot.send(getSettings().onClear, { name: args})\n    }\n  })\n\n  function chatWatcher({player, message}: { player: Player, message: string}) {\n    if (player.name == 'SERVER') return\n    message = message.toLocaleUpperCase()\n\n    deleteTrigger(player.name)\n\n    for (let [name, afk] of triggers.entries()) {\n      if (message.includes(name)) {\n        ex.bot.send(getSettings().onTrigger, {\n          message: afk,\n          name: player.name,\n          Away: name[0] + name.substr(1).toLocaleLowerCase(),\n          away: name.toLocaleLowerCase(),\n          AWAY: name\n        })\n        return // Only one afk response per message to avoid spam\n      }\n    }\n  }\n\n  function leaveWatcher(player: Player) {\n    deleteTrigger(player.name)\n  }\n\n  world.onMessage.sub(chatWatcher)\n  world.onLeave.sub(leaveWatcher)\n\n  ex.remove = () => {\n    for (let command of ['afk', 'afkclear']) {\n      world.removeCommand(command)\n    }\n    world.onMessage.unsub(chatWatcher)\n    world.onLeave.unsub(leaveWatcher)\n  }\n\n  // Browser only\n  const ui = ex.bot.getExports('ui') as UIExtensionExports | undefined\n  if (!ui) return\n\n  let tab = ui.addTab('AFK Messages')\n  tab.innerHTML = html\n\n  for (let key of Object.keys(getSettings()) as Array<keyof Settings>) {\n    let value = getSettings()[key]\n    ;(tab.querySelector(`[data-setting=${key}]`) as HTMLInputElement).value = value;\n  }\n\n  tab.addEventListener('input', () => {\n    ex.storage.set('settings', {\n      onSet: (tab.querySelector('[data-setting=onSet]') as HTMLInputElement).value,\n      onClear: (tab.querySelector('[data-setting=onClear]') as HTMLInputElement).value,\n      onTrigger: (tab.querySelector('[data-setting=onTrigger]') as HTMLInputElement).value,\n    })\n  })\n\n  ex.remove = (function(orig) {\n    return () => {\n      orig()\n      ui.removeTab(tab)\n    }\n  }(ex.remove))\n})\n"],"names":["MessageBot"],"mappings":";;;;;;;;AAWAA,cAAU,CAAC,iBAAiB,CAAC,gBAAgB,EAAE,CAAC,EAAE,EAAE,KAAK;IACvD,MAAM,WAAW,GAAG,MAAgB,MAAM,CAAC,MAAM,CAAC;QAChD,KAAK,EAAE,sDAAsD;QAC7D,OAAO,EAAE,iCAAiC;QAC1C,SAAS,EAAE,wCAAwC;KACpD,EAAE,EAAE,CAAC,OAAO,CAAC,GAAG,CAAoB,UAAU,EAAE,EAAE,CAAC,CAAC,CAAA;IAErD,IAAI,QAAQ,GAAG,IAAI,GAAG,EAAkB,CAAA;IACxC,uBAAuB,IAAY;QACjC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,iBAAiB,EAAE,CAAC,CAAA;KAC1C;IAED,KAAK,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC,MAAM,EAAE,OAAO;QACtC,IAAI,MAAM,CAAC,IAAI,KAAK,QAAQ;YAAE,OAAM;QACpC,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,CAAC,CAAA;QAClC,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,KAAK,EAAE,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,CAAC,CAAA;KACxD,CAAC,CAAA;IACF,KAAK,CAAC,UAAU,CAAC,UAAU,EAAE,CAAC,MAAM,EAAE,IAAI;QACxC,IAAI,MAAM,CAAC,OAAO,EAAE;YAClB,aAAa,CAAC,IAAI,CAAC,CAAA;YACnB,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,OAAO,EAAE,EAAE,IAAI,EAAE,IAAI,EAAC,CAAC,CAAA;SAClD;KACF,CAAC,CAAA;IAEF,qBAAqB,EAAC,MAAM,EAAE,OAAO,EAAqC;QACxE,IAAI,MAAM,CAAC,IAAI,IAAI,QAAQ;YAAE,OAAM;QACnC,OAAO,GAAG,OAAO,CAAC,iBAAiB,EAAE,CAAA;QAErC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;QAE1B,KAAK,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,IAAI,QAAQ,CAAC,OAAO,EAAE,EAAE;YAC1C,IAAI,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;gBAC1B,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,SAAS,EAAE;oBACnC,OAAO,EAAE,GAAG;oBACZ,IAAI,EAAE,MAAM,CAAC,IAAI;oBACjB,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,iBAAiB,EAAE;oBAClD,IAAI,EAAE,IAAI,CAAC,iBAAiB,EAAE;oBAC9B,IAAI,EAAE,IAAI;iBACX,CAAC,CAAA;gBACF,OAAM;aACP;SACF;KACF;IAED,sBAAsB,MAAc;QAClC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;KAC3B;IAED,KAAK,CAAC,SAAS,CAAC,GAAG,CAAC,WAAW,CAAC,CAAA;IAChC,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAA;IAE/B,EAAE,CAAC,MAAM,GAAG;QACV,KAAK,IAAI,OAAO,IAAI,CAAC,KAAK,EAAE,UAAU,CAAC,EAAE;YACvC,KAAK,CAAC,aAAa,CAAC,OAAO,CAAC,CAAA;SAC7B;QACD,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,WAAW,CAAC,CAAA;QAClC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,YAAY,CAAC,CAAA;KAClC,CAAA;;IAGD,MAAM,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAmC,CAAA;IACpE,IAAI,CAAC,EAAE;QAAE,OAAM;IAEf,IAAI,GAAG,GAAG,EAAE,CAAC,MAAM,CAAC,cAAc,CAAC,CAAA;IACnC,GAAG,CAAC,SAAS,GAAG,IAAI,CAAA;IAEpB,KAAK,IAAI,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,WAAW,EAAE,CAA0B,EAAE;QACnE,IAAI,KAAK,GAAG,WAAW,EAAE,CAAC,GAAG,CAAC,CAC7B;QAAC,GAAG,CAAC,aAAa,CAAC,iBAAiB,GAAG,GAAG,CAAsB,CAAC,KAAK,GAAG,KAAK,CAAC;KACjF;IAED,GAAG,CAAC,gBAAgB,CAAC,OAAO,EAAE;QAC5B,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE;YACzB,KAAK,EAAG,GAAG,CAAC,aAAa,CAAC,sBAAsB,CAAsB,CAAC,KAAK;YAC5E,OAAO,EAAG,GAAG,CAAC,aAAa,CAAC,wBAAwB,CAAsB,CAAC,KAAK;YAChF,SAAS,EAAG,GAAG,CAAC,aAAa,CAAC,0BAA0B,CAAsB,CAAC,KAAK;SACrF,CAAC,CAAA;KACH,CAAC,CAAA;IAEF,EAAE,CAAC,MAAM,IAAI,UAAS,IAAI;QACxB,OAAO;YACL,IAAI,EAAE,CAAA;YACN,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC,CAAA;SAClB,CAAA;KACF,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,CAAA;CACd,CAAC,CAAA;;;;"}